# 报表制作


- 下面以northWind数据集中的订单数据，制作一张中国人常用的统计报表。本报表将会用到报表参数的计算。


## 值表达式和显示值表达式

- **值表达式是计算报表每一个具体单元格的实际值用到的公式。它是报表计算的核心表达式。所有的取数表达式都是在值表达式中定义。**
- **显示值表达式是为了显示让用户更友好的阅读数据所用到的公式。**缺省公式为`=@value`。@value表示的意思是当前值表达式的值，*不能在值表达式中使用@value。*在这里可以重新组织该单元格的显示数据。比如格式化数据、显示值单元格中所取代码的代表的实际名称等。
+ 如果单元格的数据是数字类型，可以格式化数字，公式是：`=formatNumber（@value）`缺省格式为：#######.##，可以在第二个参数指定格式。如：####.0000。
+ 如果单元格是某个group函数取出的code代码，显示值表达式最好是另建一个数据集，比如叫：仓库，sql为：`select 名称，id from 仓库表`，然后在显示值表达式中写:`=仓库.select1(仓库.名称,仓库.id==@value)`，你的其他sql中都不用取名称，这样做的好处，一方面能有效减少数据量，而且更容易维护；另一个好处，在需要group的数据集上不用关联取名称，一定程度的提高sql的执行效率。
::: warning  
  不要在值表达式以为的属性中使用 分组、归并等函数。
:::
+ 如果该单元格的显示值需要从数据库查询，可以类似这样写：`=query(数据库连接变量，”select xxx from table where yyy=’+@value+”’”)`。这种方式取数相对于先定义数据集，然后用ds.select1的方式灵活，但会多次多次调用查询，不推荐这种方式，会让报表生成速度大幅下降。
+ 如果单元格的值为零，显示为空白，公式为：=iif(@value==0,’’,@value)
+ 如果单元格的值为万元为单位，公式为：`= @value/10000`,和上面的为零显示空白结合，公式为：`=iif(@value==0,’’,@value/10000)`

## 报表的钻取、跳转、排序
- 这个功能主要是通过url连接串属性实现的。在设计器上，点击该属性，进入表达式编辑页面，点生成url连接串，就可以自动生成缺省的url连接串，缺省会将所有的非内部属性组织到该url里面，其中有reportName=param.ReportName，表示的是当前的报表名，如果要跳转到其他报表，把这里的报表名称换成指定的报表名即可。如果要钻取，通常是报表名不变，参数改变，而且这通常发生在分组单元格上。比如某公司的省市县三级机构，报表开始是显示的省公司的报表，其明细是各地市的数据，可以设置报表由省公司报表向地市公司报表的钻取。

- 只要是只有一个行扩展（列扩展数不限）的报表，都已经内置了点报表表头排序。多个行扩展的报表，点击表头排序的功能是无意义的。

## 条件格式
- 针对字体颜色和背景颜色，我们也可以使用表达式动态计算，具体的颜色选取，参考设计器的下拉框。
- **类似excel中的条件格式设置。** 我们可以选中设计器中要启用条件格式的单元格，选菜单上的条件格式，选取合适的方式，就可以实现类似excel中的条件格式设置。我们也可以设置通用模式，参看 [这里](../../zh/conf/base.md#前端隔行变色和条件颜色的配置)
